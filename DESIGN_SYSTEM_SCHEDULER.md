# uTools å®šæ—¶ä»»åŠ¡æ’ä»¶ - ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡æ–¹æ¡ˆè®¾è®¡

## ğŸ“‹ ç›®å½•

1. [é—®é¢˜èƒŒæ™¯](#é—®é¢˜èƒŒæ™¯)
2. [æ–¹æ¡ˆå¯¹æ¯”](#æ–¹æ¡ˆå¯¹æ¯”)
3. [æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡](#æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡)
4. [å„å¹³å°å®ç°ç»†èŠ‚](#å„å¹³å°å®ç°ç»†èŠ‚)
5. [ç”¨æˆ·äº¤äº’æµç¨‹](#ç”¨æˆ·äº¤äº’æµç¨‹)
6. [æ•°æ®ç»“æ„è®¾è®¡](#æ•°æ®ç»“æ„è®¾è®¡)
7. [å®‰å…¨ä¸æƒé™](#å®‰å…¨ä¸æƒé™)
8. [é£é™©è¯„ä¼°](#é£é™©è¯„ä¼°)
9. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)

---

## é—®é¢˜èƒŒæ™¯

### å½“å‰é—®é¢˜

1. **uTools åå°é™åˆ¶**
   - å…³é—­çª—å£åï¼ŒuTools ä¼šæš‚åœæ’ä»¶çš„ JavaScript æ‰§è¡Œç¯å¢ƒ
   - æ‰€æœ‰ `setTimeout` / `setInterval` éƒ½ä¼šè¢«æš‚åœ
   - å³ä½¿ç”¨æˆ·è®¾ç½®äº†å®šæ—¶ä»»åŠ¡ï¼Œä¹Ÿæ— æ³•åœ¨åå°æ‰§è¡Œ

2. **è¡¥å¿æ‰§è¡Œæ–¹æ¡ˆä¸è¶³**
   - éœ€è¦ç”¨æˆ·é‡æ–°æ‰“å¼€æ’ä»¶æ‰èƒ½æ‰§è¡Œé”™è¿‡çš„ä»»åŠ¡
   - å¦‚æœç”¨æˆ·é•¿æœŸä¸æ‰“å¼€ï¼Œä»»åŠ¡æ°¸è¿œä¸ä¼šæ‰§è¡Œ
   - æ— æ³•ä¿è¯ä»»åŠ¡å‡†æ—¶æ‰§è¡Œ

3. **ç”¨æˆ·ä½“éªŒé—®é¢˜**
   - å¿…é¡»ä¿æŒçª—å£æœ€å°åŒ–ï¼ˆå ç”¨ä»»åŠ¡æ ï¼‰
   - å®šæ—¶ä»»åŠ¡ä¸å¯é 

### æ ¸å¿ƒéœ€æ±‚

âœ… **åå°å¯é æ‰§è¡Œ** - çª—å£å…³é—­åä»èƒ½å‡†æ—¶æ‰§è¡Œ
âœ… **è·¨å¹³å°æ”¯æŒ** - Windowsã€macOSã€Linux éƒ½èƒ½ç”¨
âœ… **æ˜“äºç®¡ç†** - ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°æŸ¥çœ‹ã€å¯åœã€åˆ é™¤ä»»åŠ¡

---

## æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ 1: å½“å‰æ–¹æ¡ˆ - JavaScript å®šæ—¶å™¨

**åŸç†**: ä½¿ç”¨ `setTimeout` / `setInterval`

| ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|
| å®ç°ç®€å• | âŒ çª—å£å…³é—­ååœæ­¢æ‰§è¡Œ |
| è·¨å¹³å°ç»Ÿä¸€ | âŒ æ— æ³•åå°è¿è¡Œ |
| å®æ—¶æ§åˆ¶ | âŒ éœ€è¦è¡¥å¿æœºåˆ¶ |

**ç»“è®º**: âŒ ä¸å¯ç”¨

---

### æ–¹æ¡ˆ 2: uTools ç³»ç»Ÿé€šçŸ¥

**åŸç†**: ä½¿ç”¨ `utools.notification` API

| ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|
| ç¬¦åˆ uTools ç”Ÿæ€ | âŒ é€šçŸ¥ â‰  å®šæ—¶æ‰§è¡Œ |
| å¯èƒ½å”¤é†’æ’ä»¶ | âŒ æ— æ³•æ‰§è¡Œå‘½ä»¤è¡Œ |

**ç»“è®º**: âŒ ä¸å¯è¡Œ

---

### æ–¹æ¡ˆ 3: ç‹¬ç«‹åå°è¿›ç¨‹

**åŸç†**: æ’ä»¶å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„ Node.js å­è¿›ç¨‹

| ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|
| å¯ä»¥åå°è¿è¡Œ | âŒ uTools å¯èƒ½ç®¡ç†å­è¿›ç¨‹ |
| ç‹¬ç«‹äºæ’ä»¶ | âŒ å¢åŠ å¤æ‚åº¦ |
| | âŒ èµ„æºå ç”¨ |

**ç»“è®º**: âš ï¸ å¯èƒ½ä¸å¯è¡Œï¼ˆéœ€è¦éªŒè¯ uTools æ˜¯å¦å…è®¸ï¼‰

---

### æ–¹æ¡ˆ 4: **ç³»ç»Ÿçº§å®šæ—¶ä»»åŠ¡ï¼ˆæ¨èï¼‰** â­

**åŸç†**: åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„åŸç”Ÿå®šæ—¶ä»»åŠ¡ç³»ç»Ÿ

| ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|
| âœ… å®Œç¾åå°è¿è¡Œ | éœ€è¦ç³»ç»Ÿæƒé™ |
| âœ… å‡†æ—¶æ‰§è¡Œ | å®ç°ç›¸å¯¹å¤æ‚ |
| âœ… ç‹¬ç«‹äº uTools | éœ€è¦å¤„ç†è·¨å¹³å°å·®å¼‚ |
| âœ… ç³»ç»Ÿçº§å¯é æ€§ | |

**ç»“è®º**: âœ… **æœ€ä½³æ–¹æ¡ˆ**

---

## æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

### æ ¸å¿ƒæ€è·¯

```
uTools æ’ä»¶ï¼ˆé…ç½®ç®¡ç†å±‚ï¼‰
    â†“
ç”Ÿæˆç³»ç»Ÿå®šæ—¶ä»»åŠ¡é…ç½®
    â†“
è°ƒç”¨ç³»ç»Ÿå‘½ä»¤æ³¨å†Œä»»åŠ¡
    â†“
ç³»ç»Ÿå®šæ—¶æœåŠ¡ç‹¬ç«‹æ‰§è¡Œ
    â†“
ï¼ˆå¯é€‰ï¼‰æ”¶é›†æ‰§è¡Œç»“æœ
```

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         uTools æ’ä»¶ç•Œé¢                â”‚
â”‚  - ä»»åŠ¡åˆ—è¡¨å±•ç¤º                        â”‚
â”‚  - æ–°å¢/ç¼–è¾‘/åˆ é™¤ä»»åŠ¡                 â”‚
â”‚  - æ‰§è¡Œå†å²æŸ¥çœ‹                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä»»åŠ¡ç®¡ç†å™¨ (Task Manager)       â”‚
â”‚  - è´Ÿè´£ä»»åŠ¡ CRUD                      â”‚
â”‚  - ç”Ÿæˆç³»ç»Ÿä»»åŠ¡é…ç½®                   â”‚
â”‚  - è°ƒç”¨ç³»ç»Ÿå‘½ä»¤æ³¨å†Œ/åˆ é™¤              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Windows    â”‚    â”‚  Unix-like    â”‚
â”‚  ä»»åŠ¡è®¡åˆ’   â”‚    â”‚  Cron/Launchdâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å„å¹³å°å®ç°ç»†èŠ‚

### Windows å¹³å°

#### æ–¹å¼ 1: ä»»åŠ¡è®¡åˆ’ç¨‹åºï¼ˆTask Schedulerï¼‰

**å‘½ä»¤**: `schtasks.exe`

```javascript
// åˆ›å»ºä»»åŠ¡
const command = `
  schtasks /Create
    /TN "uTools-${taskId}"
    /TR "command"
    /SC schedule
    /ST time
    /MO modifier
    /F
`;

// åˆ é™¤ä»»åŠ¡
const deleteCommand = `schtasks /Delete /TN "uTools-${taskId}" /F`;

// æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
const queryCommand = `schtasks /Query /TN "uTools-${taskId}" /FO LIST /V`;
```

**æ”¯æŒçš„ä»»åŠ¡ç±»å‹**:
- `/SC ONCE` - æ‰§è¡Œä¸€æ¬¡
- `/SC DAILY` - æ¯å¤©
- `/SC WEEKLY` - æ¯å‘¨
- `/SC HOURLY` - æ¯å°æ—¶
- `/SC MINUTE` - æ¯éš” N åˆ†é’Ÿ

**ç¤ºä¾‹**:
```batch
# æ¯å¤©æ—©ä¸Š 9 ç‚¹æ‰§è¡Œ
schtasks /Create /TN "uTools-task-123" /TR "notepad.exe" /SC DAILY /ST 09:00

# æ¯ 15 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
schtasks /Create /TN "uTools-task-124" /TR "echo test" /SC MINUTE /MO 15
```

#### æ–¹å¼ 2: PowerShellï¼ˆå¤‡é€‰ï¼‰

```powershell
# åˆ›å»ºä»»åŠ¡
$action = New-ScheduledTaskAction -Execute "command"
$trigger = New-ScheduledTaskTrigger -Daily -At "09:00"
Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "uTools-task-123"
```

**ä¼˜ç¼ºç‚¹**:
- âœ… åŠŸèƒ½æ›´å¼ºå¤§
- âŒ éœ€è¦ PowerShell 5.0+

---

### Linux å¹³å°

#### æ–¹å¼: Cron

**å‘½ä»¤**: `crontab`

```javascript
// ç”Ÿæˆ crontab æ¡ç›®
const cronEntry = `${minute} ${hour} ${day} ${month} ${weekday} ${command}`;

// æ·»åŠ åˆ°ç”¨æˆ·çš„ crontab
const command = `(crontab -l 2>/dev/null; echo "${cronEntry}") | crontab -`;

// åˆ é™¤ï¼ˆé‡æ–°ç”Ÿæˆä¸åŒ…å«è¯¥ä»»åŠ¡çš„ crontabï¼‰
const deleteCommand = `crontab -l | grep -v "uTools-${taskId}" | crontab -`;
```

**Cron è¡¨è¾¾å¼æ ¼å¼**:
```
* * * * * command
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€ æ˜ŸæœŸ (0-7, 0å’Œ7éƒ½è¡¨ç¤ºå‘¨æ—¥)
â”‚ â”‚ â”‚ â””â”€â”€â”€ æœˆä»½ (1-12)
â”‚ â”‚ â””â”€â”€â”€â”€â”€ æ—¥æœŸ (1-31)
â”‚ â””â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0-59)
```

**ç¤ºä¾‹**:
```bash
# æ¯å¤© 21:28 æ‰§è¡Œ
28 21 * * * /path/to/command

# å·¥ä½œæ—¥æ—©ä¸Š 9 ç‚¹æ‰§è¡Œ
0 9 * * 1-5 /path/to/command

# æ¯ 15 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
*/15 * * * * /path/to/command
```

**ä¼˜ç¼ºç‚¹**:
- âœ… çµæ´»å¼ºå¤§
- âœ… ç³»ç»Ÿçº§å¯é æ€§
- âš ï¸ éœ€è¦å¤„ç†æƒé™é—®é¢˜
- âš ï¸ éœ€è¦ç¡®ä¿å‘½ä»¤è·¯å¾„æ­£ç¡®

---

### macOS å¹³å°

#### æ–¹å¼ 1: Cronï¼ˆåŒ Linuxï¼‰

macOS ä¹Ÿæ”¯æŒ cronï¼Œä½† Apple æ¨èä½¿ç”¨ launchdã€‚

#### æ–¹å¼ 2: launchdï¼ˆæ¨èï¼‰

**æ–‡ä»¶ä½ç½®**: `~/Library/LaunchAgents/com.utools.scheduledtask.${taskId}.plist`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.utools.scheduledtask.${taskId}</string>

    <key>ProgramArguments</key>
    <array>
        <string>/bin/bash</string>
        <string>-c</string>
        <string>command here</string>
    </array>

    <key>StartCalendarInterval</key>
    <dict>
        <key>Hour</key>
        <integer>21</integer>
        <key>Minute</key>
        <integer>28</integer>
    </dict>
</dict>
</plist>
```

**åŠ è½½/å¸è½½å‘½ä»¤**:
```bash
# åŠ è½½ä»»åŠ¡
launchctl load ~/Library/LaunchAgents/com.utools.scheduledtask.${taskId}.plist

# å¸è½½ä»»åŠ¡
launchctl unload ~/Library/LaunchAgents/com.utools.scheduledtask.${taskId}.plist

# æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨
launchctl list | grep com.utools.scheduledtask
```

**ä¼˜ç¼ºç‚¹**:
- âœ… macOS å®˜æ–¹æ¨è
- âœ… æ”¯æŒæ›´å¤šåŠŸèƒ½ï¼ˆç½‘ç»œå”¤é†’ã€ç”µæºç®¡ç†ç­‰ï¼‰
- âš ï¸ é…ç½®æ–‡ä»¶æ ¼å¼å¤æ‚

---

## ç”¨æˆ·äº¤äº’æµç¨‹

### åˆ›å»ºä»»åŠ¡æµç¨‹

```
1. ç”¨æˆ·æ‰“å¼€æ’ä»¶
   â†“
2. ç‚¹å‡»"æ–°å¢ä»»åŠ¡"
   â†“
3. å¡«å†™ä»»åŠ¡ä¿¡æ¯ï¼š
   - ä»»åŠ¡åç§°
   - æ‰§è¡Œå‘½ä»¤
   - å®šæ—¶ç±»å‹ï¼ˆé—´éš”/æ¯æ—¥/Cronï¼‰
   - å¯ç”¨çŠ¶æ€
   â†“
4. ç‚¹å‡»ä¿å­˜
   â†“
5. æ’ä»¶ç”Ÿæˆç³»ç»Ÿä»»åŠ¡é…ç½®
   â†“
6. è°ƒç”¨ç³»ç»Ÿå‘½ä»¤æ³¨å†Œä»»åŠ¡
   â†“
7. æ˜¾ç¤ºæˆåŠŸ/å¤±è´¥æç¤º
```

### åˆ é™¤ä»»åŠ¡æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»åˆ é™¤æŒ‰é’®
   â†“
2. ç¡®è®¤åˆ é™¤
   â†“
3. è°ƒç”¨ç³»ç»Ÿå‘½ä»¤åˆ é™¤ç³»ç»Ÿä»»åŠ¡
   â†“
4. ä»æ•°æ®åº“åˆ é™¤ä»»åŠ¡è®°å½•
   â†“
5. åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
```

### æŸ¥çœ‹æ‰§è¡Œå†å²

**æ–¹æ¡ˆ 1**: ä¸ä¿å­˜å†å²ï¼ˆç®€åŒ–ç‰ˆï¼‰
- ç³»ç»Ÿå®šæ—¶ä»»åŠ¡æ‰§è¡Œåï¼ŒuTools æ’ä»¶æ— æ³•è·çŸ¥
- ç”¨æˆ·å¯ä»¥é€šè¿‡ç³»ç»Ÿå·¥å…·æŸ¥çœ‹ï¼ˆä»»åŠ¡è®¡åˆ’ç¨‹åº / syslogï¼‰

**æ–¹æ¡ˆ 2**: ä¿å­˜å†å²ï¼ˆå®Œæ•´ç‰ˆï¼‰
- ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œå°†ç»“æœå†™å…¥æ–‡ä»¶
- uTools æ’ä»¶å®šæœŸè¯»å–æ–‡ä»¶å¹¶æ›´æ–°å†å²è®°å½•
- å®ç°å¤æ‚ï¼Œç”¨æˆ·ä½“éªŒå¥½

---

## æ•°æ®ç»“æ„è®¾è®¡

### ä»»åŠ¡å­˜å‚¨ï¼ˆdbStorageï¼‰

```javascript
{
  "scheduled_tasks_tasks": [
    {
      "id": "task_1234567890_abc123",
      "name": "æ¯å¤©å¤‡ä»½",
      "command": "echo 'backup'",
      "type": "daily",  // interval | daily | cron
      "intervalValue": "1m",  // å½“ type=interval æ—¶
      "dailyTime": "09:00",  // å½“ type=daily æ—¶
      "cronExpression": "0 9 * * *",  // å½“ type=cron æ—¶
      "enabled": true,
      "systemTaskRegistered": true,  // ç³»ç»Ÿä»»åŠ¡æ˜¯å¦å·²æ³¨å†Œ
      "systemTaskName": "uTools-task-1234567890",  // ç³»ç»Ÿä»»åŠ¡åç§°
      "createdAt": 1234567890000,
      "updatedAt": 1234567890000
    }
  ]
}
```

### æ‰§è¡Œå†å²ï¼ˆå¯é€‰ï¼‰

```javascript
{
  "scheduled_tasks_history": [
    {
      "id": "exec_1234567890_def456",
      "taskId": "task_1234567890_abc123",
      "taskName": "æ¯å¤©å¤‡ä»½",
      "command": "echo 'backup'",
      "executedAt": 1234567890000,
      "status": "success",  // success | failure
      "exitCode": 0,
      "output": "stdout content",
      "error": "stderr content",
      "duration": 1234
    }
  ]
}
```

---

## å®‰å…¨ä¸æƒé™

### Windows æƒé™

**åˆ›å»ºä»»åŠ¡**:
- ä¸éœ€è¦ç®¡ç†å‘˜æƒé™ï¼ˆåˆ›å»ºå½“å‰ç”¨æˆ·çš„ä»»åŠ¡ï¼‰
- `/RU` å‚æ•°æŒ‡å®šè¿è¡Œèº«ä»½

**å¯èƒ½çš„é—®é¢˜**:
- æŸäº›å‘½ä»¤å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½æ‰§è¡Œ
- éœ€è¦å¼•å¯¼ç”¨æˆ·ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ uToolsï¼ˆä¸æ¨èï¼‰

### Linux/macOS æƒé™

**Cron æƒé™**:
- æ™®é€šç”¨æˆ·å¯ä»¥ç®¡ç†è‡ªå·±çš„ crontab
- ä¸éœ€è¦ root æƒé™

**Launchd æƒé™**:
- æ™®é€šç”¨æˆ·å¯ä»¥ç®¡ç†è‡ªå·±çš„ LaunchAgents
- ä¸éœ€è¦ sudo

### å®‰å…¨å»ºè®®

1. **å‘½ä»¤æ³¨å…¥é˜²æŠ¤**
   - éªŒè¯ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤
   - è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦

2. **è·¯å¾„å®‰å…¨**
   - ä½¿ç”¨ç»å¯¹è·¯å¾„
   - æˆ–è€…è®¾ç½®ç¯å¢ƒå˜é‡

3. **æ—¥å¿—è®°å½•**
   - è®°å½•æ‰€æœ‰ç³»ç»Ÿå‘½ä»¤è°ƒç”¨
   - ä¾¿äºè°ƒè¯•å’Œå®¡è®¡

---

## é£é™©è¯„ä¼°

### æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| å‘½ä»¤æ‰§è¡Œå¤±è´¥ | ç”¨æˆ·ä»»åŠ¡æ— æ³•æ‰§è¡Œ | ä¸­ | æ·»åŠ è¯¦ç»†çš„é”™è¯¯æç¤ºå’Œæ—¥å¿— |
| æƒé™ä¸è¶³ | æŸäº›ä»»åŠ¡æ— æ³•åˆ›å»º | ä½ | æå‰æ£€æŸ¥æƒé™ï¼Œç»™å‡ºæç¤º |
| è·¨å¹³å°å…¼å®¹æ€§ | æŸäº›å¹³å°å®ç°æœ‰å·®å¼‚ | ä¸­ | å……åˆ†æµ‹è¯•å„å¹³å° |
| ç³»ç»Ÿä»»åŠ¡è¢«æ‰‹åŠ¨åˆ é™¤ | æ’ä»¶çŠ¶æ€ä¸ä¸€è‡´ | ä¸­ | å®šæœŸåŒæ­¥çŠ¶æ€ |

### ç”¨æˆ·ä½“éªŒé£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| å­¦ä¹ æˆæœ¬é«˜ | ç”¨æˆ·ä¸ç†è§£ç³»ç»Ÿä»»åŠ¡ | ä½ | æ·»åŠ è¯¦ç»†è¯´æ˜å’Œå¼•å¯¼ |
| è¯¯åˆ é™¤ç³»ç»Ÿä»»åŠ¡ | æ’ä»¶åŠŸèƒ½å¼‚å¸¸ | ä¸­ | æ·»åŠ "ä¿®å¤"åŠŸèƒ½ï¼Œé‡æ–°æ³¨å†Œ |
| æ— æ³•æŸ¥çœ‹æ‰§è¡Œå†å² | ç”¨æˆ·ä½“éªŒä¸‹é™ | ä¸­ | æä¾›æŸ¥çœ‹å†å²çš„æ–¹æ³• |

---

## å®æ–½è®¡åˆ’

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆæœ€å°å¯è¡Œç‰ˆæœ¬ï¼‰

**ç›®æ ‡**: å®ç°åŸºæœ¬çš„ç³»ç»Ÿå®šæ—¶ä»»åŠ¡åŠŸèƒ½

- [ ] å®ç° Windows ä»»åŠ¡è®¡åˆ’ç¨‹åºé›†æˆ
- [ ] å®ç°åŸºæœ¬çš„ä»»åŠ¡åˆ›å»º/åˆ é™¤
- [ ] æ”¯æŒ"æ¯æ—¥å®šæ—¶"å’Œ"Cron è¡¨è¾¾å¼"
- [ ] åŸºæœ¬çš„é”™è¯¯å¤„ç†

**ä¸åŒ…å«**:
- âŒ æ‰§è¡Œå†å²
- âŒ æ‰§è¡Œç»“æœæ”¶é›†
- âŒ Linux/macOS æ”¯æŒ

### Phase 2: è·¨å¹³å°æ”¯æŒ

- [ ] å®ç° Linux cron é›†æˆ
- [ ] å®ç° macOS launchd é›†æˆ
- [ ] å¹³å°æ£€æµ‹å’Œè‡ªåŠ¨é€‰æ‹©

### Phase 3: å¢å¼ºåŠŸèƒ½

- [ ] æ‰§è¡Œå†å²è®°å½•
- [ ] æ‰§è¡Œç»“æœé€šçŸ¥
- [ ] ä»»åŠ¡çŠ¶æ€åŒæ­¥æ£€æµ‹
- [ ] æ‰¹é‡æ“ä½œ

### Phase 4: ä¼˜åŒ–å’Œå®Œå–„

- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] é”™è¯¯æç¤ºä¼˜åŒ–
- [ ] æ–‡æ¡£å’Œæ•™ç¨‹

---

## ä»£ç ç»“æ„è®¾è®¡ï¼ˆå»ºè®®ï¼‰

```
preload.js
â”œâ”€â”€ Storage              # æ•°æ®æŒä¹…åŒ–
â”œâ”€â”€ SystemTaskManager    # ç³»ç»Ÿä»»åŠ¡ç®¡ç†ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ WindowsTaskManager
â”‚   â”œâ”€â”€ LinuxTaskManager
â”‚   â””â”€â”€ MacTaskManager
â”œâ”€â”€ CommandRunner        # å‘½ä»¤æ‰§è¡Œ
â””â”€â”€ Scheduler           # ä¿ç•™ï¼Œç”¨äºå…¼å®¹æ€§ï¼ˆæˆ–åˆ é™¤ï¼‰

app.js
â”œâ”€â”€ ä»»åŠ¡ç®¡ç† UI
â””â”€â”€ æ‰§è¡Œå†å² UIï¼ˆå¯é€‰ï¼‰
```

---

## ç¤ºä¾‹ä»£ç ç»“æ„

### SystemTaskManager æ¥å£

```javascript
class SystemTaskManager {
  /**
   * åˆ›å»ºç³»ç»Ÿå®šæ—¶ä»»åŠ¡
   * @param {Object} task - ä»»åŠ¡å¯¹è±¡
   * @returns {Promise<boolean>} - æ˜¯å¦æˆåŠŸ
   */
  async createSystemTask(task) {
    // å¹³å°æ£€æµ‹
    const platform = this.detectPlatform();

    // è°ƒç”¨å¯¹åº”å¹³å°çš„å®ç°
    switch (platform) {
      case 'windows':
        return WindowsTaskManager.create(task);
      case 'linux':
        return LinuxTaskManager.create(task);
      case 'macos':
        return MacTaskManager.create(task);
      default:
        throw new Error('Unsupported platform');
    }
  }

  /**
   * åˆ é™¤ç³»ç»Ÿå®šæ—¶ä»»åŠ¡
   */
  async deleteSystemTask(taskId, systemTaskName) {
    // ...
  }

  /**
   * æ£€æµ‹ç³»ç»Ÿä»»åŠ¡æ˜¯å¦å­˜åœ¨
   */
  async checkSystemTaskExists(systemTaskName) {
    // ...
  }

  /**
   * å¹³å°æ£€æµ‹
   */
  detectPlatform() {
    if (utools.isWindows()) return 'windows';
    if (utools.isLinux()) return 'linux';
    if (utools.isMacOS()) return 'macos';
    throw new Error('Unknown platform');
  }
}
```

### WindowsTaskManager ç¤ºä¾‹

```javascript
class WindowsTaskManager {
  static async create(task) {
    const taskName = `uTools-task-${task.id}`;
    const command = task.command;

    // æ„å»º schtasks å‘½ä»¤
    let schedule = '';
    switch (task.type) {
      case 'daily':
        schedule = `/SC DAILY /ST ${task.dailyTime}`;
        break;
      case 'cron':
        // éœ€è¦å°† cron è¡¨è¾¾å¼è½¬æ¢ä¸º schtasks æ ¼å¼
        schedule = this.parseCronToSchtasks(task.cronExpression);
        break;
      // ...
    }

    const cmd = `schtasks /Create /TN "${taskName}" /TR "${command}" ${schedule} /F`;

    // æ‰§è¡Œå‘½ä»¤
    const { stdout, stderr } = await exec(cmd);

    if (stderr.includes('SUCCESS')) {
      return true;
    } else {
      throw new Error(stderr);
    }
  }

  static async delete(taskId, systemTaskName) {
    const cmd = `schtasks /Delete /TN "${systemTaskName}" /F`;
    await exec(cmd);
    return true;
  }
}
```

---

## æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

âœ… **å½»åº•è§£å†³åå°è¿è¡Œé—®é¢˜**
âœ… **ç³»ç»Ÿçº§å¯é æ€§**
âœ… **ä¸ä¾èµ– uTools çª—å£çŠ¶æ€**
âœ… **ç¬¦åˆæ“ä½œç³»ç»Ÿæœ€ä½³å®è·µ**

### æ³¨æ„äº‹é¡¹

âš ï¸ **å®ç°å¤æ‚åº¦å¢åŠ **
âš ï¸ **éœ€è¦å¤„ç†å¹³å°å·®å¼‚**
âš ï¸ **è°ƒè¯•ç›¸å¯¹å›°éš¾**
âš ï¸ **ç”¨æˆ·å­¦ä¹ æˆæœ¬**

### å»ºè®®

1. **å…ˆå®ç° Windows ç‰ˆæœ¬**ï¼ˆç”¨æˆ·æœ€å¤šï¼‰
2. **é€æ­¥å®Œå–„å…¶ä»–å¹³å°**
3. **ä¿ç•™å½“å‰æ–¹æ¡ˆä½œä¸ºå¤‡é€‰**ï¼ˆé…ç½®é¡¹è®©ç”¨æˆ·é€‰æ‹©ï¼‰
4. **å……åˆ†æµ‹è¯•**åå†å‘å¸ƒ

---

**æ˜¯å¦ç»§ç»­å®æ–½æ­¤æ–¹æ¡ˆï¼Ÿ** è¯·å®¡æŸ¥åå†³å®šã€‚
